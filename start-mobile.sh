#!/bin/bash

# Okuma Analizi - Mobile Access Starter
# Bu script otomatik olarak IP adresinizi algÄ±lar ve sistemi baÅŸlatÄ±r

echo "ðŸš€ Okuma Analizi - Mobil EriÅŸim BaÅŸlatÄ±cÄ±"
echo "========================================"
echo ""

# IP adresini algÄ±la
if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    HOST_IP=$(ipconfig getifaddr en0 2>/dev/null || ipconfig getifaddr en1 2>/dev/null)
    if [ -z "$HOST_IP" ]; then
        echo "âš ï¸  WiFi baÄŸlantÄ±sÄ± bulunamadÄ±!"
        echo "Ethernet veya baÅŸka bir aÄŸ baÄŸlantÄ±sÄ± kullanÄ±yor olabilirsiniz."
        echo ""
        echo "Mevcut IP adresleri:"
        ifconfig | grep "inet " | grep -v 127.0.0.1 | awk '{print "  - " $2}'
        echo ""
        read -p "Kullanmak istediÄŸiniz IP adresini girin: " HOST_IP
    fi
else
    # Linux
    HOST_IP=$(hostname -I | awk '{print $1}')
fi

if [ -z "$HOST_IP" ]; then
    echo "âŒ IP adresi algÄ±lanamadÄ±!"
    exit 1
fi

echo "âœ… IP Adresi: $HOST_IP"
echo ""

# .env.local dosyasÄ±nÄ± gÃ¼ncelle
echo "ðŸ“ Frontend .env.local dosyasÄ± gÃ¼ncelleniyor..."
cat > frontend/.env.local << EOF
# Frontend Environment Configuration
# Auto-generated by start-mobile.sh

# API Configuration - Use your machine's IP address for mobile access
NEXT_PUBLIC_API_URL=http://${HOST_IP}:8000
NEXT_PUBLIC_APP_NAME=Okuma Analizi

# Development Settings
NODE_ENV=development
NEXT_PUBLIC_DEBUG=false
EOF

echo "âœ… .env.local gÃ¼ncellendi"
echo ""

# Docker servisleri yeniden baÅŸlat
echo "ðŸ”„ Docker servisleri yeniden baÅŸlatÄ±lÄ±yor..."
export HOST_IP=$HOST_IP
docker-compose restart frontend api

echo ""
echo "âœ… Sistem hazÄ±r!"
echo ""
echo "ðŸ“± Mobil cihazÄ±nÄ±zdan ÅŸu adreslere eriÅŸebilirsiniz:"
echo "   Frontend: http://${HOST_IP}:3000"
echo "   Backend:  http://${HOST_IP}:8000"
echo ""
echo "ðŸ’¡ Not: Mobil cihazÄ±nÄ±zÄ±n aynÄ± WiFi aÄŸÄ±nda olduÄŸundan emin olun!"
echo ""

